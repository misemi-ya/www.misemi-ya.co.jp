<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·å“¡ãƒãƒ¼ã‚¿ãƒ«ãƒ›ãƒ¼ãƒ  - åº—é­…å‰å±‹å¤§å­¦</title>
    <!-- MSAL.js ã®èª­ã¿è¾¼ã¿ -->
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; font-family: 'Roboto', sans-serif; }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .portal-header {
            background-color: #003366; color: white;
            padding: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .portal-nav-container {
            max-width: 1200px; margin: 0 auto; padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .portal-title { font-size: 1.2rem; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .user-info { display: flex; align-items: center; gap: 15px; font-size: 0.95rem; }
        .user-name-display { font-weight: bold; color: #ffeb3b; } /* åå‰ã‚’ç›®ç«‹ãŸã›ã‚‹ */
        
        .btn-logout {
            background-color: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4);
            color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; text-decoration: none; font-size: 0.85rem;
        }
        .btn-logout:hover { background-color: rgba(255,255,255,0.3); }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .portal-main { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .welcome-banner {
            background: linear-gradient(135deg, #0055a4, #003366);
            color: white; padding: 30px; border-radius: 8px; margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .welcome-banner h2 { margin: 0 0 10px 0; font-size: 1.8rem; }
        
        /* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ */
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        .card {
            background: white; border-radius: 8px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .card-header {
            background-color: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #eee;
            font-weight: bold; color: #333; display: flex; align-items: center; gap: 10px;
        }
        .card-body { padding: 20px; }
        .card-body ul { list-style: none; padding: 0; margin: 0; }
        .card-body li {
            padding: 10px 0; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between;
        }
        .card-body li:last-child { border-bottom: none; }
        .card-body li a { color: #0056b3; text-decoration: none; }
        .card-body li a:hover { text-decoration: underline; }
        
        .badge { background: #d9534f; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; margin-left: 5px; }
        .date { color: #888; font-size: 0.85rem; }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999; display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem; color: #666;
        }
    </style>
</head>
<body>
    <!-- èªè¨¼ç¢ºèªã¾ã§ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
    <div id="loading">èªè¨¼æƒ…å ±ã‚’ç¢ºèªä¸­...</div>

    <header class="portal-header">
        <div class="portal-nav-container">
            <div class="portal-title">
                <span>åº—é­…å‰å±‹å¤§å­¦ è·å“¡ãƒãƒ¼ã‚¿ãƒ«</span>
            </div>
            <div class="user-info">
                <!-- â–¼ã“ã“ã«Azureã‹ã‚‰å–å¾—ã—ãŸåå‰ãŒå…¥ã‚Šã¾ã™ -->
                <span>ã‚ˆã†ã“ãã€<span id="displayName" class="user-name-display">ã‚²ã‚¹ãƒˆ</span> ã•ã‚“</span>
                <button onclick="signOut()" class="btn-logout">ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>
    </header>

    <main class="portal-main">
        <div class="welcome-banner">
            <!-- ãƒãƒŠãƒ¼å†…ã«ã‚‚åå‰ã‚’è¡¨ç¤º -->
            <h2>ãŠç–²ã‚Œæ§˜ã§ã™ã€<span id="bannerName">è·å“¡</span>ã•ã‚“ã€‚</h2>
            <p>æœ¬æ—¥ã®ãŠçŸ¥ã‚‰ã›ã¨ã‚¿ã‚¹ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <div class="dashboard-grid">
            <!-- ãŠçŸ¥ã‚‰ã›ã‚«ãƒ¼ãƒ‰ -->
            <div class="card">
                <div class="card-header">
                    <span>ğŸ“¢ å¤§å­¦ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›</span>
                </div>
                <div class="card-body">
                    <ul>
                        <li>
                            <a href="#">ã€é‡è¦ã€‘æ¬¡æœŸå±¥ä¿®ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦</a>
                            <span class="badge">NEW</span>
                        </li>
                        <li>
                            <a href="#">æ§‹å†…ä¸€æ–‰åœé›»ã®ãŠçŸ¥ã‚‰ã› (12/25)</a>
                            <span class="date">2025.12.10</span>
                        </li>
                        <li>
                            <a href="#">å¹´æœ«å¹´å§‹ã®äº‹å‹™å–ã‚Šæ‰±ã„ã«ã¤ã„ã¦</a>
                            <span class="date">2025.12.01</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- äº‹å‹™ã‚·ã‚¹ãƒ†ãƒ ãƒªãƒ³ã‚¯ -->
            <div class="card">
                <div class="card-header">
                    <span>ğŸ’» æ¥­å‹™ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</span>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <a href="#" class="btn btn-secondary" style="text-align:center; padding:10px;">æ•™å‹™ã‚·ã‚¹ãƒ†ãƒ </a>
                        <a href="#" class="btn btn-secondary" style="text-align:center; padding:10px;">äººäº‹ãƒ»çµ¦ä¸</a>
                        <a href="#" class="btn btn-secondary" style="text-align:center; padding:10px;">è²¡å‹™ä¼šè¨ˆ</a>
                        <a href="#" class="btn btn-secondary" style="text-align:center; padding:10px;">æ–½è¨­äºˆç´„</a>
                        <a href="https://outlook.office.com" target="_blank" class="btn btn-primary" style="text-align:center; padding:10px; grid-column: span 2;">Outlook Web Mail</a>
                    </div>
                </div>
            </div>

            <!-- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ -->
            <div class="card">
                <div class="card-header">
                    <span>ğŸ“ æ‰¿èªå¾…ã¡æ¡ˆä»¶</span>
                </div>
                <div class="card-body">
                    <ul>
                        <li>
                            <span>å‡ºå¼µç”³è«‹æ›¸ï¼ˆç”°ä¸­ å¤ªéƒï¼‰</span>
                            <a href="#">ç¢ºèª</a>
                        </li>
                        <li>
                            <span>ç‰©å“è³¼å…¥ç”³è«‹ï¼ˆç ”ç©¶æ”¯æ´èª²ï¼‰</span>
                            <a href="#">ç¢ºèª</a>
                        </li>
                        <li style="justify-content: center; margin-top: 10px;">
                            <a href="#" style="font-weight:bold;">ã™ã¹ã¦ã®æ¡ˆä»¶ã‚’è¦‹ã‚‹ &gt;</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
    <script src="msal-config.js"></script>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.addEventListener('load', async () => {
            try {
                // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç­‰ã®å‡¦ç†å¾…ã¡
                await myMSALObj.handleRedirectPromise();

                const currentAccounts = myMSALObj.getAllAccounts();

                if (currentAccounts.length === 0) {
                    // ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã‘ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸å¼·åˆ¶é€é‚„
                    window.location.href = "index.html";
                } else {
                    // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¦è¡¨ç¤º
                    const account = currentAccounts[0];
                    const username = account.name; // Azureä¸Šã®è¡¨ç¤ºå (ä¾‹: å±±ç”° å¤ªéƒ)
                    
                    document.getElementById("displayName").textContent = username;
                    document.getElementById("bannerName").textContent = username;
                    
                    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’æ¶ˆã™
                    document.getElementById("loading").style.display = "none";
                }
            } catch (error) {
                console.error(error);
                alert("èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚");
                window.location.href = "index.html";
            }
        });

        // ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆå‡¦ç†
        function signOut() {
            const logoutRequest = {
                account: myMSALObj.getAccountByHomeId(myMSALObj.getAllAccounts()[0].homeAccountId),
                postLogoutRedirectUri: msalConfig.auth.redirectUri // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¾Œã«index.htmlã«æˆ»ã‚‹
            };
            myMSALObj.logoutPopup(logoutRequest);
            // ã¾ãŸã¯ myMSALObj.logoutRedirect(logoutRequest);
        }
    </script>
</body>
</html>