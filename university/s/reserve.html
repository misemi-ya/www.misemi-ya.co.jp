<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>施設予約 | Misemi-ya University</title>
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; background: #f5f7fa; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { color: #003366; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { background: #003366; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        button:hover { background: #002244; }
        .reservation-list { margin-top: 30px; }
        .res-item { background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 5px solid #003366; display: flex; justify-content: space-between; }
    </style>
</head>
<body>
    <div class="container">
        <a href="l.html">← ダッシュボードに戻る</a>
        <h1>施設予約システム</h1>
        
        <div class="form-group">
            <label>施設</label>
            <select id="facility">
                <option>第1会議室</option>
                <option>第2会議室</option>
                <option>講堂</option>
                <option>体育館</option>
            </select>
        </div>
        <div class="form-group">
            <label>日付</label>
            <input type="date" id="date">
        </div>
        <div class="form-group">
            <label>時間</label>
            <input type="time" id="time">
        </div>
        <div class="form-group">
            <label>利用者名</label>
            <input type="text" id="name" placeholder="氏名を入力">
        </div>
        <button onclick="addReservation()">予約する</button>

        <div class="reservation-list">
            <h3>現在の予約状況</h3>
            <div id="list">読み込み中...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase Config (あなたのもの)
        const firebaseConfig = {
            apiKey: "AIzaSyAuj26lGBWGdcfiLoiCl8s0jTQN3UBu_iM",
            authDomain: "misemiya-portal.firebaseapp.com",
            databaseURL: "https://misemiya-portal-default-rtdb.firebaseio.com",
            projectId: "misemiya-portal",
            storageBucket: "misemiya-portal.firebasestorage.app",
            messagingSenderId: "869803502016",
            appId: "1:869803502016:web:341b0d0d9d6a4f88c00025"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const resRef = ref(db, 'reservations');

        window.addReservation = () => {
            const fac = document.getElementById('facility').value;
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const name = document.getElementById('name').value;
            
            if(!date || !time || !name) { alert("全ての項目を入力してください"); return; }
            
            push(resRef, { facility: fac, date: date, time: time, name: name });
            alert("予約しました");
        };

        onValue(resRef, (snapshot) => {
            const list = document.getElementById('list');
            list.innerHTML = '';
            if(!snapshot.exists()) { list.innerHTML = '予約はありません'; return; }
            
            snapshot.forEach(child => {
                const r = child.val();
                const div = document.createElement('div');
                div.className = 'res-item';
                div.innerHTML = `
                    <div><strong>${r.date} ${r.time}</strong> - ${r.facility} (${r.name})</div>
                    <button onclick="deleteRes('${child.key}')" style="background:#d9534f; padding:5px 10px; font-size:0.8rem;">削除</button>
                `;
                list.appendChild(div);
            });
        });
        
        window.deleteRes = (key) => {
            if(confirm('予約を取り消しますか？')) remove(ref(db, 'reservations/' + key));
        }
    </script>
</body>
</html>